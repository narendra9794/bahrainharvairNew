@model List<Bahrin.Harbour.Model.ClientModel.PropertyViewModel>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
  // Layout = null;
  var a = ViewBag.ClientId;
 
}

<style>
  .propertydiv{
    border: 1px solid #cfcece;
    border-radius: 28px;
    padding: 10px;
    margin-top: 40px;
  }
</style>
<!--start wrapper-->
<div class="wrapper">
  <!--start top header-->
  <?php include('header.php'); ?>
  <!--start content-->
  <main class="page-content">
    <div class="px-3">
      <div class="card-header bg-transparent border-0">
        <div class="row g-3 align-items-center">
         
          <div class="row g-3 align-items-center mt-4 mb-2">
          <div class="col-12 col-md-2 col-lg-2">
            <label class="font-500 font-18 text-dark">Add Property</label>
          </div>
        </div>
        </div>
      </div>
      <div class="card-body profile">         
        
          <div class="col-12 col-md-4 col-lg-4">

            <div class="small-12 medium-2 large-2 columns position-relative">
              <div class="circle">
              
                <img class="profile-pic" src="~/images/buildingimage.png" alt="avatar-2" width="32" id="imageid" /> 

              </div>
              <div class="p-image">
               @*  <i class="fadeIn animated bx bx-upload upload-button"></i>  Upload Image *@
                <span class=" upload-button"><i class="fadeIn animated bx bx-upload"></i>  Upload Image</span>
                <input class="file-upload" type="file" accept="image/*" />
              </div>
            </div>
          </div>
      
      </div>

         <div id="Addpropertydiv" style="display: block;">
            <div class="row">
          <input hidden id="clientid" value="@a" />

              <div  class="col-12 col-md-4 col-lg-4 mb-4">
                <label class="form-label">Type of Properties<span class="text-danger">*</span></label>
                <select  class="form-select form-control" aria-label="Default select example" id="TypePropertiesSelect">
                 <option value="" >Select a Property</option>
                  <option value="AF">Residential</option>
                  <option value="AX">Commercial</option>
                  <option value="AL">Industrial</option>
                  <option value="DZ">Agricultural</option>
                </select>
              </div>
            <div class="col-12 col-md-4 col-lg-4 mb-4">
              <label class="form-label">Country<span class="text-danger">*</span></label>

                        <select class="form-select form-control" aria-label="Default select example" id="country">
                            <option value="">Select Country</option>
                        </select>
            </div>
            <div class="col-12 col-md-4 col-lg-4 mb-4">
              <label class="form-label">State<span class="text-danger">*</span></label>
                @*         <label class="form-label">State<span class="text-danger">*</span></label> *@
                        <select class="form-select form-control" aria-label="Default select example" id="state">
                            <option value="">Select State</option>
                        </select>
                    </div>
            <div class="col-12 col-md-4 col-lg-4 mb-4">
              <label class="form-label">Address<span class="text-danger">*</span></label>
              <input class="form-control" type="text" id="addressid" />
            </div>
            <div class="col-12 col-md-4 col-lg-4 mb-4">
                <label class="form-label">Property Price<span class="text-danger">*</span></label>
                <input  class="form-control" id="Pro_Price" type="text" />
              </div>
         
            </div>
            <div class="row">
              <div class="col-12 col-md-4 col-lg-4 mb-4">
            <button type="button" class="btn btn-outline-secondary font-14 me-2" style="background-color: red; color: white; border-color: red;"  onclick="Cancel()">Cancel</button>
                
                <button class="btn btn-warning font-14 ms-auto px-4" type="button" onclick="Savedataproperty()">Add Property </button>
              
              </div>
            </div>
          </div>

        
          
      </div> 
    </div>

    
   

  </main>
  <!--end page main-->
  <!--start overlay-->
  <div class="overlay nav-toggle-icon"></div>
  <!--end overlay-->
  <!--Start Back To Top Button-->
  <a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
  <!--End Back To Top Button-->
  <!--start switcher-->
</div>
<!--end wrapper-->
<!-- Bootstrap bundle JS -->

<script src="~/js/bootstrap.bundle.min.js"></script>
<!--plugins-->
<script src="~/js/jquery.min.js"></script>
<script src="~/plugins/simplebar/js/simplebar.min.js"></script>
<script src="~/plugins/metismenu/js/metisMenu.min.js"></script>
<script src="~/plugins/easyPieChart/jquery.easypiechart.js"></script>
<script src="~/plugins/peity/jquery.peity.min.js"></script>
<script src="~/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
<script src="~/js/pace.min.js"></script>
<script src="~/plugins/vectormap/jquery-jvectormap-2.0.2.min.js"></script>
<script src="~/plugins/vectormap/jquery-jvectormap-world-mill-en.js"></script>
<script src="~/plugins/apexcharts-bundle/js/apexcharts.min.js"></script>
<script src="~/plugins/datatable/js/jquery.dataTables.min.js"></script>
<script src="~/plugins/datatable/js/dataTables.bootstrap5.min.js"></script>
<!--app-->
<script src="~/js/app.js"></script>

<script>
  function Cancel() {
    debugger;
    var clientId = $("#clientid").val();
    window.location.href = "/Administration/Client/Property?ClientId=" + clientId;
    // window.location.href = "Administration/Client/Property";

  }

  function AddProperties() {
    $("#detailspropertydiv").css("display", "none");
    $("#Addpropertydiv").css("display", "block");

  }
  function Savedataproperty()
  {
    var clientId = $("#clientid").val();
    var img = $("#imageid").val()
    var typeOfProperty = $("#TypePropertiesSelect option:selected").text();
    var countryId = $("#country option:selected").text();
    var stateId = $("#state").val();
    var addressId = $("#addressid").val();
    var propertyPrice = $("#Pro_Price").val();
    debugger;
    var formData = new FormData();
    formData.append("ClientUserId", $("#clientid").val());
    // formData.append("ClientUserId",$("#clientid").val());
    formData.append("TypeOfProperty", $("#TypePropertiesSelect").val());
    formData.append("Country", $("#country").val());
    formData.append("State", $("#state").val());
    formData.append("Address", $("#addressid").val());
    formData.append("PropertyPrice", $("#Pro_Price").val());
    formData.append("ImageFile", $("#imageid").val());
    var imageFile = $('.file-upload')[0].files[0];
    formData.append("ImageFile", imageFile);


    var typeOfProperty = $("#TypePropertiesSelect").val();
    if (!typeOfProperty) {
      alert("Type of Property is required.");
      return;
    }

    // Validate Country
    var Countryid = $("#country").val();
    if (!Countryid) {
      alert("Country is required.");
      return;
    }

    if (!stateId) {
      showToast("error", "State is required.");

      return;
    }
    if (!addressId) {
      showToast("error", "Address is required.");

      return;
    }
    if (!propertyPrice || isNaN(propertyPrice) || propertyPrice <= 0) {
      alert("Please enter a valid Property Price.");
      return;
    }
    $.ajax({
      url: '@Url.Action("AddNewProperty", "Client")',
      type: 'POST',
      processData: false,
      contentType: false,
      data: formData,
      success: function (response) {

        showToast("success", "property details saved successfully!");

        $("#state").val("");
        $("#addressid").val("");
        $("#Pro_Price").val("");
        $("#upload_media").val("");

        $("#property-list-table tbody").empty();



        setTimeout(function () {
          window.location.href = "/Administration/Client/Property?ClientId=" + clientId;
        }, 2000);
      }
    });
  }
</script>
<script>
  $(document).ready(function () {
    var readURL = function (input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
          $('.profile-pic').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
      }
    }


    $(".file-upload").on('change', function () {
      readURL(this);
    });

    $(".upload-button").on('click', function () {
      $(".file-upload").click();
    });
  });

</script>