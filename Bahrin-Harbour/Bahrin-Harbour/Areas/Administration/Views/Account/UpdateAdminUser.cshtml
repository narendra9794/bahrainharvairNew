@model Bahrin.Harbour.Model.AccountModel.AdminUserModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!doctype html>
<html lang="en" class="minimal-theme">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="~/images/favicon-32x32.png" type="image/png" />
    <link href="~/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
    <link href="~/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet" />
    <link href="~/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet" />
    <link href="~/plugins/vectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet" />
    <link href="~/plugins/datatable/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    <link href="~/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/css/bootstrap-extended.css" rel="stylesheet" />
    <link href="~/css/style.css" rel="stylesheet" />
    <link href="~/css/icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link href="https://fonts.cdnfonts.com/css/hero-new" rel="stylesheet">
    <link href="~/css/pace.min.css" rel="stylesheet" />
    <title>Mapme</title>
    <style>
        .faded-input {
            opacity: 0.5; /* Adjust this value to control the fade level */
            background-color: #f5f5f5; /* Optional: Set a light background to enhance the faded look */
            cursor: not-allowed; /* Show a 'not-allowed' cursor to indicate it's readonly */
        }

    </style>
</head>
<body>
    <div class="wrapper">
        <main class="page-content">
            <div class="px-3">
                <div class="card-header bg-transparent border-0 mb-4">
                    <div class="row g-3 align-items-center">
                        <div class="col-12">
                            <h5 class="mb-1">Settings</h5>
                            <p class="font-14">Manage your details and personal preferences here</p>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="tab-pane fade active show" id="primary-pills-home" role="tabpanel">
                        <form class="form-body pt-2" id="smtpForm" method="post">
                            <div class="small-12 medium-2 large-2 columns position-relative align-items-center d-flex">
                                <div class="circle" >
                                    <img id="profileImage" class="profile-pic"  alt="avatar-2" width="32">
                                </div>
                                <div class="ms-4">
                                    <label id="imageChange"  for="imageUpload" class="btn btn_warning font-14 ms-auto px-4 me-2" hidden>Change Image</label>
                                    <input asp-for="ImageFile" type="file" id="imageUpload" accept="image/*" style="display: none;" readonly />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 col-12 mb-3">
                                    <label class="mb-1">First Name</label>
                                    <input asp-for="FirstName" class="form-control border-bottom2 height-50" disabled />
                                    <span asp-validation-for="FirstName" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <label class="mb-1">Last Name</label>
                                    <input asp-for="LastName" class="form-control border-bottom2 height-50" disabled />
                                    <span asp-validation-for="LastName" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <label class="mb-1">State</label>
                                    <input asp-for="State" class="form-control border-bottom2 height-50" disabled />
                                    <span asp-validation-for="State" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <label class="mb-1">City</label>
                                    <input asp-for="City" class="form-control border-bottom2 height-50" disabled />
                                    <span asp-validation-for="City" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <label class="mb-1">Country</label>
                                    <input asp-for="Country" class="form-control border-bottom2 height-50" disabled />
                                    <span asp-validation-for="Country" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <label class="mb-1">Phone</label>
                                    <input asp-for="PhoneNumber" class="form-control border-bottom2 height-50" disabled />
                                    <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <label class="mb-1">Pin</label>
                                    <input asp-for="Pin" class="form-control border-bottom2 height-50" disabled />
                                    <span asp-validation-for="Pin" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <label class="mb-1">Address</label>
                                    <input asp-for="Address" class="form-control border-bottom2 height-50" disabled />
                                    <span asp-validation-for="Address" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <input asp-for="Role" class="form-control border-bottom2 height-50" hidden />
                                </div>
                                <div class="col-md-4 col-12 mb-3">
                                    <input asp-for="Email" class="form-control border-bottom2 height-50" hidden />
                                </div>
                            </div>
                            <div class="row mt-1 mb-4">
                                <div class="col-6 col-md-8 col-lg-8 text-right">
                                    <button type="button" class="btn btn-primary" id="editButton">Edit</button>
         
                                    <button type="button" class="btn btn-success" id="saveButton" hidden>Save</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
        <div class="overlay nav-toggle-icon"></div>
        <a href="javascript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
    </div>

    <script src="~/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/jquery.min.js"></script>
    <script src="~/plugins/simplebar/js/simplebar.min.js"></script>
    <script src="~/plugins/metismenu/js/metisMenu.min.js"></script>
    <script src="~/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
    <script src="~/js/pace.min.js"></script>
    <script src="~/js/app.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.19.3/jquery.validate.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.19.3/jquery.validate.unobtrusive.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            $.ajax({
                url: '@Url.Action("GetAdminDetails", "Account", new { area = "Administration" })',
                type: 'GET',
                success: function (data) {
                    $('input[name="FirstName"]').val(data.firstName);
                    $('input[name="FirstName"]').val(data.firstName);
                    $('input[name="LastName"]').val(data.lastName);
                    $('input[name="State"]').val(data.state);
                    $('input[name="City"]').val(data.city);
                    $('input[name="Country"]').val(data.country);
                    $('input[name="PhoneNumber"]').val(data.phoneNumber);
                    $('input[name="Pin"]').val(data.pin);
                    $('input[name="Address"]').val(data.address);
                    $('input[name="Role"]').val(data.role);
                    $('input[name="Email"]').val(data.email);
                    if (data.imageLink) {
                        $('#profileImage').attr('src', data.imageLink)
                    }
                },
                error: function () {
                    alert('Error fetching data from the server.');
                }
            });

            $('#editButton').click(function () {
                $('input').prop('disabled', false);
                $('#saveButton').prop('hidden', false);
                $('#editButton').prop('hidden', true);
                $('#imageChange').prop('hidden', false);
            });

            $('#saveButton').click(function () {
                var formData = new FormData();

                formData.append('FirstName', $('input[name="FirstName"]').val());
                formData.append('LastName', $('input[name="LastName"]').val());
                formData.append('State', $('input[name="State"]').val());
                formData.append('City', $('input[name="City"]').val());
                formData.append('Country', $('input[name="Country"]').val());
                formData.append('PhoneNumber', $('input[name="PhoneNumber"]').val());
                formData.append('Pin', $('input[name="Pin"]').val());
                formData.append('Address', $('input[name="Address"]').val());
                formData.append('Email', $('input[name="Email"]').val());
                formData.append('Role', $('input[name="Role"]').val());

                var fileInput = $('input[name="ImageFile"]')[0]; 
                if (fileInput.files.length > 0) {
                    formData.append('ImageFile', fileInput.files[0]);
                }

                $.ajax({
                    url: '@Url.Action("UpdateAdminUser", "Account", new { area = "Administration" })',
                    type: 'POST',
                    data: formData,
                    contentType: false, 
                    processData: false, 
                    success: function (response) {
                        $('input').prop('disabled', true);
                        $('#saveButton').prop('hidden', true);

                        if (response.status === true) {
                            showToast("success", response.message);

                            setTimeout(function () {
                                window.location.href = '@Url.Action("Dashboard", "Dashboard", new { area = "Administration" })';
                            }, 3000);
                        } else {
                            showToast("error", response.message)
                        }

                    },
                    error: function () {
                        alert('Error saving data.');
                    }
                });
            });

        });

        document.getElementById('imageUpload').addEventListener('change', function (event) {
            const input = event.target;
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('profileImage').src = e.target.result; 
                }
                reader.readAsDataURL(input.files[0]);
            }
        });
    </script>

</body>
</html>
